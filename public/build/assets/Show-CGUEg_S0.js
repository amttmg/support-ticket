import{x as N,G as q,f as i,o as n,b as t,h as c,t as l,F as m,k as x,c as z,n as H,l as D,a as y,u as g,g as Q,w as C,S as G,e as u,d as J,j as K,E as W,Q as E}from"./app-BSgs8Lu9.js";import{_ as X}from"./AuthenticatedLayout-BeAxI95q.js";import{S as f}from"./sweetalert-B6YkYn-g.js";const Y={class:"flex items-start justify-between"},Z={class:"flex items-center"},tt={class:"flex items-center justify-center w-8 h-8 mr-3 font-bold text-gray-600 bg-gray-300 rounded-full"},et={class:"font-semibold"},st={class:"ml-2 text-sm text-gray-500"},ot=["innerHTML"],nt={key:0,class:"mt-4 space-y-4"},it={__name:"Comment",props:{comment:Object,ticketId:Number},setup(s){return N({body:"",parent_id:s.comment.id}),(a,_)=>{var k,b,d;const v=q("Comment",!0);return n(),i("div",{class:H(["p-4 border border-gray-200 rounded-lg",{"ml-8":s.comment.parent_id}])},[t("div",Y,[t("div",Z,[t("div",tt,l((b=((k=s.comment.user)==null?void 0:k.name)||s.comment.guest_name)==null?void 0:b.charAt(0).toUpperCase()),1),t("div",null,[t("span",et,l(((d=s.comment.user)==null?void 0:d.name)||s.comment.guest_name),1),t("span",st,l(a.$filters.timeAgo(s.comment.created_at)),1)])])]),t("p",{class:"mt-2 whitespace-pre-line",innerHTML:s.comment.body},null,8,ot),s.comment.children&&s.comment.children.length?(n(),i("div",nt,[(n(!0),i(m,null,x(s.comment.children,p=>(n(),z(v,{key:p.id,comment:p,"ticket-id":s.ticketId},null,8,["comment","ticket-id"]))),128))])):c("",!0)],2)}}},lt={class:"py-12"},rt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},at={class:"mb-4"},dt={class:"flex flex-col gap-6 lg:flex-row"},ct={class:"flex-1 overflow-hidden bg-white shadow-sm sm:rounded-lg"},mt={class:"p-6 text-gray-900"},ut={class:"mb-6"},ft={class:"text-2xl font-bold"},gt={class:"text-sm text-gray-500"},xt={class:"p-4 mb-8 rounded-lg bg-gray-50"},ht={class:"whitespace-pre-line"},kt={key:0,class:"p-4 mb-8 rounded-lg bg-gray-50"},bt={class:"space-y-2"},pt={class:"flex items-center space-x-2"},vt={class:"text-sm text-gray-700 truncate max-w-[200px]"},wt=["onClick"],yt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center transition-all bg-black bg-opacity-50"},Ct={class:"relative bg-white rounded-lg shadow-lg w-11/12 md:w-3/4 lg:w-1/2 max-h-[90vh] overflow-auto"},_t={class:"p-4"},jt={class:"mb-4 text-lg font-medium"},$t={key:0,class:"flex justify-center"},Tt=["src"],St={key:1,class:"w-full h-[80vh]"},Mt=["src"],Bt={class:"mt-8"},At={key:0,class:"space-y-4"},Lt={class:"flex justify-end mt-2"},It=["disabled"],Ft={class:"w-full lg:w-80 xl:w-96"},Rt={class:"overflow-hidden bg-white shadow-sm sm:rounded-lg"},Ut={class:"p-6"},Vt={class:"space-y-4"},Dt={class:"inline-block px-3 py-1 mt-1 text-sm font-semibold text-purple-800 bg-purple-100 rounded-full"},Et={class:"inline-block px-3 py-1 mt-1 text-sm font-semibold text-orange-800 bg-orange-100 rounded-full"},Nt={class:"px-3 py-1 text-sm font-semibold text-blue-800 bg-blue-100 rounded-full"},zt={class:"flex flex-wrap items-center gap-2 mt-1"},Ht=["src"],Ot={class:"text-sm text-gray-900"},Pt={key:1,class:"text-sm text-gray-500"},qt={class:"mt-1 text-sm text-gray-900"},Qt={key:0},Gt={class:"flex space-x-2"},Jt={key:1,class:"mt-6"},Kt={class:"space-y-2"},Wt=["src"],Xt={class:"flex-1 text-sm text-gray-900"},Yt={class:"text-gray-600"},Zt={class:"capitalize"},te={key:0,class:"mt-1 text-xs text-gray-700"},ee={class:"text-red-500"},se={class:"text-green-600"},oe={class:"mt-1 text-xs text-gray-500"},re={__name:"Show",props:{ticket:Object,comments:Object},setup(s){const h=D(!1),a=D(null),_=r=>{a.value=r,h.value=!0},v=()=>{h.value=!1,a.value=null},k=r=>/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(r),b=s,d=N({body:"",parent_id:null}),p=()=>{d.post(route("tickets.comments.store",{ticket:b.ticket.id}),{preserveScroll:!0,onSuccess:()=>d.reset()})},O=async r=>{(await f.confirm({title:"Re-open Ticket?",text:"This will change the ticket status back to open",icon:"question",confirmColor:"#10B981",confirmText:"Re-open"})).isConfirmed&&E.put(route("tickets.reopen",r.id),{onSuccess:()=>{f.success("Ticket has been re-opened!")},onError:()=>{f.error("Failed to re-open ticket")}})},P=async r=>{(await f.confirm({title:"Close Ticket?",text:"This will permanently close the ticket",icon:"warning",confirmColor:"#EF4444",confirmText:"Close"})).isConfirmed&&E.put(route("tickets.close",r.id),{onSuccess:()=>{f.success("Ticket has been closed!")},onError:()=>{f.error("Failed to close ticket")}})};return(r,e)=>(n(),i(m,null,[y(g(Q),{title:s.ticket.title},null,8,["title"]),y(X,null,{header:C(()=>e[3]||(e[3]=[t("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Ticket Information ",-1)])),default:C(()=>{var j,$,T;return[t("div",lt,[t("div",rt,[t("div",at,[y(g(G),{href:r.route("tickets.index"),class:"inline-flex items-center text-blue-600 hover:underline"},{default:C(()=>e[4]||(e[4]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 19l-7-7 7-7"})],-1),u(" Back ")])),_:1,__:[4]},8,["href"])]),t("div",dt,[t("div",ct,[t("div",mt,[t("div",ut,[t("h3",ft,l(s.ticket.title),1),t("p",gt,"Ticket ID: #"+l(s.ticket.id),1)]),t("div",xt,[e[5]||(e[5]=t("h4",{class:"mb-2 text-lg font-medium"},"Description",-1)),t("p",ht,l(s.ticket.description),1)]),s.ticket.files&&s.ticket.files.length?(n(),i("div",kt,[e[7]||(e[7]=t("h4",{class:"mb-3 text-lg font-medium"},"Attachments",-1)),t("ul",bt,[(n(!0),i(m,null,x(s.ticket.files,o=>(n(),i("li",{key:o.id,class:"flex items-center justify-between p-2 border rounded-md"},[t("div",pt,[e[6]||(e[6]=t("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l7.778-7.778a4 4 0 00-5.656-5.656L4.93 11.07a6 6 0 108.485 8.485L19 14"})],-1)),t("span",vt,l(o.original_name.split("/").pop()),1)]),t("button",{onClick:w=>_(o),class:"inline-flex items-center px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"}," View ",8,wt)]))),128))])])):c("",!0),h.value?(n(),i("div",yt,[t("div",Ct,[t("button",{onClick:v,class:"absolute text-2xl font-bold text-gray-600 top-2 right-2 hover:text-red-500"},"×"),t("div",_t,[t("h4",jt,l((j=a.value)==null?void 0:j.original_name.split("/").pop()),1),k(a.value.file_path)?(n(),i("div",$t,[t("img",{src:`/storage/${a.value.file_path}`,alt:"Preview",class:"max-w-full max-h-[80vh] rounded"},null,8,Tt)])):(n(),i("div",St,[t("iframe",{src:`/storage/${a.value.file_path}`,class:"w-full h-full rounded",frameborder:"0"},null,8,Mt)]))])])])):c("",!0),t("div",Bt,[e[8]||(e[8]=t("h4",{class:"mb-4 text-lg font-medium"},"Comments",-1)),s.comments&&s.comments.length?(n(),i("div",At,[(n(!0),i(m,null,x(s.comments,o=>(n(),z(it,{key:o.id,comment:o,"ticket-id":s.ticket.id},null,8,["comment","ticket-id"]))),128))])):c("",!0),s.ticket.status.name!="Closed"?(n(),i("form",{key:1,onSubmit:J(p,["prevent"]),class:"mt-4"},[K(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=o=>g(d).body=o),class:"w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Add a comment...",required:""},null,512),[[W,g(d).body]]),t("div",Lt,[t("button",{type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:g(d).processing}," Post Comment ",8,It)])],32)):c("",!0)])])]),t("div",Ft,[t("div",Rt,[t("div",Ut,[e[21]||(e[21]=t("h3",{class:"mb-4 text-lg font-medium"},"Ticket Information",-1)),t("div",Vt,[t("div",null,[e[9]||(e[9]=t("h4",{class:"text-sm font-medium text-gray-500"},"Created",-1)),t("span",Dt,l(r.$filters.timeAgo(s.ticket.created_at)),1)]),t("div",null,[e[10]||(e[10]=t("h4",{class:"text-sm font-medium text-gray-500"},"Last Updated",-1)),t("span",Et,l(r.$filters.timeAgo(s.ticket.updated_at)),1)]),t("div",null,[e[11]||(e[11]=t("h4",{class:"text-sm font-medium text-gray-500"},"Priority",-1)),t("span",{class:H([{"bg-green-100 text-green-800":s.ticket.priority==="low","bg-yellow-100 text-yellow-800":s.ticket.priority==="medium","bg-red-100 text-red-800":s.ticket.priority==="high"},"px-3 py-1 text-sm font-semibold capitalize rounded-full"])},l(s.ticket.priority),3)]),t("div",null,[e[12]||(e[12]=t("h4",{class:"text-sm font-medium text-gray-500"},"Status",-1)),t("span",Nt,l(s.ticket.status.name),1)]),t("div",null,[e[13]||(e[13]=t("h4",{class:"text-sm font-medium text-gray-500"},"Assigned To",-1)),t("div",zt,[s.ticket.agents&&s.ticket.agents.length?(n(!0),i(m,{key:0},x(s.ticket.agents,o=>(n(),i("div",{key:o.id,class:"flex items-center gap-2"},[t("img",{src:o.avatar||"https://ui-avatars.com/api/?name="+encodeURIComponent(o.name),alt:"Avatar",class:"object-cover border rounded-full w-7 h-7"},null,8,Ht),t("span",Ot,l(o.name),1)]))),128)):(n(),i("span",Pt,"Unassigned"))])]),t("div",null,[e[14]||(e[14]=t("h4",{class:"text-sm font-medium text-gray-500"},"Created By",-1)),t("p",qt,l(($=s.ticket.creator)==null?void 0:$.name),1)]),s.ticket.status.name.toLowerCase()==="resolved"?(n(),i("div",Qt,[e[17]||(e[17]=t("h4",{class:"text-sm font-medium text-gray-500"},"Action",-1)),t("div",Gt,[t("button",{onClick:e[1]||(e[1]=o=>O(s.ticket)),class:"inline-flex items-center px-4 py-2 text-sm font-semibold text-white transition bg-green-600 rounded-md shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2",title:"Re-open Ticket"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2a4 4 0 014-4h3"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h3v3"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17a5 5 0 10-5-5"})],-1),u(" Re-open ")])),t("button",{onClick:e[2]||(e[2]=o=>P(s.ticket)),class:"inline-flex items-center px-4 py-2 text-sm font-semibold text-white transition bg-red-600 rounded-md shadow hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2",title:"Close Ticket"},e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),u(" Close ")]))])])):c("",!0),(T=s.ticket.activities)!=null&&T.length?(n(),i("div",Jt,[e[20]||(e[20]=t("h4",{class:"mb-2 text-sm font-medium text-gray-500"},"History",-1)),t("div",Kt,[(n(!0),i(m,null,x(s.ticket.activities,o=>{var w,S,M,B,A,L,I,F,R,U,V;return n(),i("div",{key:o.id,class:"flex gap-3 p-2 border rounded bg-gray-50"},[t("img",{src:((w=o.causer)==null?void 0:w.avatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((S=o.causer)==null?void 0:S.name)||"System")}`,alt:"Avatar",class:"object-cover w-8 h-8 border rounded-full"},null,8,Wt),t("div",Xt,[t("strong",null,l(((M=o.causer)==null?void 0:M.name)||"System")+":",1),t("span",Yt,[(A=(B=o.properties)==null?void 0:B.attributes)!=null&&A["status.name"]&&((I=(L=o.properties)==null?void 0:L.old)!=null&&I["status.name"])?(n(),i(m,{key:0},[e[18]||(e[18]=u(" Changed status to ")),t("strong",Zt,l(o.properties.attributes["status.name"]),1)],64)):(n(),i(m,{key:1},[u(l(o.description),1)],64))]),(R=(F=o.properties)==null?void 0:F.old)!=null&&R["status.name"]&&((V=(U=o.properties)==null?void 0:U.attributes)!=null&&V["status.name"])?(n(),i("div",te,[t("span",ee,l(o.properties.old["status.name"]),1),e[19]||(e[19]=u(" → ")),t("span",se,l(o.properties.attributes["status.name"]),1)])):c("",!0),t("div",oe,l(new Date(o.created_at).toLocaleString()),1)])])}),128))])])):c("",!0)])])])])])])])]}),_:1})],64))}};export{re as default};
